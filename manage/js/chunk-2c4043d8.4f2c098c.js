(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2c4043d8"],{"535e":function(t,e,a){},"5a76":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Card",{attrs:{shadow:""}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("城市管理")]),a("a",{directives:[{name:"show",rawName:"v-show",value:t.canAdd,expression:"canAdd"}],attrs:{slot:"extra",role:"button"},on:{click:function(e){return e.preventDefault(),t.addCity(e)}},slot:"extra"},[a("Icon",{attrs:{type:"md-add-circle",size:16}}),t._v("添加城市\n        ")],1),a("Form",{ref:"formSearch",staticClass:"form-search",attrs:{"label-width":80,model:t.formSearch,inline:""},nativeOn:{submit:function(t){t.preventDefault()},keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchNow(e)}}},[a("FormItem",{attrs:{label:"国家",prop:"country_id"}},[a("Select",{model:{value:t.formSearch.country_id,callback:function(e){t.$set(t.formSearch,"country_id",e)},expression:"formSearch.country_id"}},t._l(t.countryList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name_cn))])}),1)],1),a("FormItem",{attrs:{label:"简称",prop:"abbr"}},[a("Input",{attrs:{placeholder:"输入城市简称"},model:{value:t.formSearch.abbr,callback:function(e){t.$set(t.formSearch,"abbr",e)},expression:"formSearch.abbr"}})],1),a("FormItem",{attrs:{label:"中文名称",prop:"name_cn"}},[a("Input",{attrs:{placeholder:"输入城市中文名称"},model:{value:t.formSearch.name_cn,callback:function(e){t.$set(t.formSearch,"name_cn",e)},expression:"formSearch.name_cn"}})],1),a("FormItem",{attrs:{label:"英文名称",prop:"name_en"}},[a("Input",{attrs:{placeholder:"输入城市英文名称"},model:{value:t.formSearch.name_en,callback:function(e){t.$set(t.formSearch,"name_en",e)},expression:"formSearch.name_en"}})],1),a("FormItem",{attrs:{label:"热门城市",prop:"is_hot"}},[a("Select",{model:{value:t.formSearch.is_hot,callback:function(e){t.$set(t.formSearch,"is_hot",e)},expression:"formSearch.is_hot"}},[a("Option",{attrs:{value:"1"}},[t._v("是")]),a("Option",{attrs:{value:"0"}},[t._v("否")])],1)],1),a("FormItem",{attrs:{"label-width":0}},[a("Button",{attrs:{type:"primary"},on:{click:t.searchNow}},[t._v("搜索")])],1),a("FormItem",{attrs:{"label-width":0}},[a("Button",{attrs:{type:"default"},on:{click:t.searchReset}},[t._v("重置")])],1)],1),a("tables",{ref:"tables",attrs:{loading:t.tableLoading,columns:t.columns},model:{value:t.tableData,callback:function(e){t.tableData=e},expression:"tableData"}}),a("Page",{ref:"pager",staticStyle:{"margin-top":"15px"},attrs:{current:t.formSearch.page,total:t.total,"page-size":t.formSearch.pageSize,"page-size-opts":[20,40,60,100,500,1e3,5e3,1e4],"show-sizer":"","show-elevator":"","show-total":""},on:{"on-change":t.pageChange,"on-page-size-change":t.pageSizeChange}})],1),a("Modal",{attrs:{title:t.modalTitle,"mask-closable":!1},model:{value:t.showCityModal,callback:function(e){t.showCityModal=e},expression:"showCityModal"}},[a("Form",{ref:"formCity",attrs:{"label-width":80,model:t.formCity},nativeOn:{submit:function(t){t.preventDefault()},keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSaveCity(e)}}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"国家",prop:"country_id",rules:{required:!0,message:"请选择国家",trigger:"change"}}},[a("Select",{model:{value:t.formCity.country_id,callback:function(e){t.$set(t.formCity,"country_id",e)},expression:"formCity.country_id"}},t._l(t.countryList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name_cn))])}),1)],1)],1),a("Col",{attrs:{span:"1"}},[t._v(" ")]),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"封面",prop:"cover.url",rules:{required:!0,message:"请上传封面",trigger:"change"}}},[a("div",{staticClass:"d-flex"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.formCity.cover.url.length>0,expression:"formCity.cover.url.length > 0"}],staticClass:"img-option",style:"background-image:url("+t.formCity.cover.url+")",on:{click:function(e){return e.preventDefault(),t.removeCover(e)}}},[a("span",[t._v("删除")])]),a("Upload",{attrs:{action:t.baseUrl+"/upload/",name:"files","show-upload-list":!1,format:["jpg","jpeg","png","gif"],"max-size":2048,"on-success":t.handleUploadSuccess,"on-format-error":t.handleUploadFormatError,"on-exceeded-size":t.handleUploadMaxSize}},[a("Button",{attrs:{icon:"md-cloud-upload",size:"small"}},[t._v("上传")])],1)],1)])],1)],1),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"缩写",prop:"abbr"}},[a("Input",{staticClass:"txt-uppercase",attrs:{type:"text",placeholder:"请输入城市缩写"},model:{value:t.formCity.abbr,callback:function(e){t.$set(t.formCity,"abbr",e)},expression:"formCity.abbr"}})],1)],1),a("Col",{attrs:{span:"1"}},[t._v(" ")]),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{label:"城市排名",prop:"livable_rank"}},[a("Input",{attrs:{type:"text",placeholder:"请输入宜居城市排名"},model:{value:t.formCity.livable_rank,callback:function(e){t.$set(t.formCity,"livable_rank",e)},expression:"formCity.livable_rank"}})],1)],1)],1),a("FormItem",{attrs:{label:"名称"}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{"label-width":0,prop:"name_cn",rules:{required:!0,message:"请输入城市名称(中文)",trigger:"change"}}},[a("Input",{attrs:{type:"text",placeholder:"中文",maxlength:255},model:{value:t.formCity.name_cn,callback:function(e){t.$set(t.formCity,"name_cn",e)},expression:"formCity.name_cn"}})],1)],1),a("Col",{attrs:{span:"1"}},[t._v(" ")]),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{"label-width":0,prop:"name_en",rules:{required:!0,message:"请输入城市名称(英文)",trigger:"change"}}},[a("Input",{attrs:{type:"text",placeholder:"英文",maxlength:255},model:{value:t.formCity.name_en,callback:function(e){t.$set(t.formCity,"name_en",e)},expression:"formCity.name_en"}})],1)],1)],1)],1),a("FormItem",{attrs:{label:"面积"}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{"label-width":0,prop:"area_cn"}},[a("Input",{attrs:{type:"text",placeholder:"中文",maxlength:255},model:{value:t.formCity.area_cn,callback:function(e){t.$set(t.formCity,"area_cn",e)},expression:"formCity.area_cn"}})],1)],1),a("Col",{attrs:{span:"1"}},[t._v(" ")]),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{"label-width":0,prop:"area_en"}},[a("Input",{attrs:{type:"text",placeholder:"英文",maxlength:255},model:{value:t.formCity.area_en,callback:function(e){t.$set(t.formCity,"area_en",e)},expression:"formCity.area_en"}})],1)],1)],1)],1),a("FormItem",{attrs:{label:"气候"}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{"label-width":0,prop:"climate_cn"}},[a("Input",{attrs:{type:"text",placeholder:"中文",maxlength:255},model:{value:t.formCity.climate_cn,callback:function(e){t.$set(t.formCity,"climate_cn",e)},expression:"formCity.climate_cn"}})],1)],1),a("Col",{attrs:{span:"1"}},[t._v(" ")]),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{"label-width":0,prop:"climate_en"}},[a("Input",{attrs:{type:"text",placeholder:"英文",maxlength:255},model:{value:t.formCity.climate_en,callback:function(e){t.$set(t.formCity,"climate_en",e)},expression:"formCity.climate_en"}})],1)],1)],1)],1),a("FormItem",{attrs:{label:"特色"}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{"label-width":0,prop:"feature_cn"}},[a("Input",{attrs:{type:"text",placeholder:"中文",maxlength:255},model:{value:t.formCity.feature_cn,callback:function(e){t.$set(t.formCity,"feature_cn",e)},expression:"formCity.feature_cn"}})],1)],1),a("Col",{attrs:{span:"1"}},[t._v(" ")]),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{"label-width":0,prop:"feature_en"}},[a("Input",{attrs:{type:"text",placeholder:"英文",maxlength:255},model:{value:t.formCity.feature_en,callback:function(e){t.$set(t.formCity,"feature_en",e)},expression:"formCity.feature_en"}})],1)],1)],1)],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",loading:t.saving},on:{click:t.handleSaveCity}},[t.saving?a("span",[t._v("保存中")]):a("span",[t._v("确定")])]),a("Button",{attrs:{type:"default"},on:{click:t.handleCloseCityModal}},[t._v("关闭")])],1)],1),a("Modal",{attrs:{width:600,title:t.modalTitle,"mask-closable":!1},model:{value:t.showSchoolModal,callback:function(e){t.showSchoolModal=e},expression:"showSchoolModal"}},[a("school-modal",{ref:"schoolModal"}),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:function(e){t.showSchoolModal=!1}}},[t._v("关闭")])],1)],1),a("Modal",{attrs:{width:600,title:t.modalTitle,"mask-closable":!1},model:{value:t.showMediaModal,callback:function(e){t.showMediaModal=e},expression:"showMediaModal"}},[a("media-modal",{ref:"mediaModal"}),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:function(e){t.showMediaModal=!1}}},[t._v("关闭")])],1)],1)],1)},n=[],r=(a("7f7f"),a("cebc")),s=a("fa69"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("tables",{attrs:{size:"small",columns:t.columns,loading:t.tableLoading},model:{value:t.tableData,callback:function(e){t.tableData=e},expression:"tableData"}}),t.canAdd?a("Button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary",size:"small",icon:"md-add-circle"},on:{click:function(e){return e.preventDefault(),t.handleAdd(e)}}},[t._v("添加学校")]):t._e(),a("Modal",{attrs:{title:t.modalTitle,"mask-closable":!1},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("Form",{ref:"form",attrs:{"label-width":80,model:t.form},nativeOn:{submit:function(t){t.preventDefault()},keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSave(e)}}},[a("FormItem",{attrs:{label:"学校名称"}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{"label-width":0,prop:"name_cn",rules:{required:!0,message:"请输入学校名称(中文)",trigger:"change"}}},[a("Input",{attrs:{type:"text",placeholder:"中文",maxlength:255},model:{value:t.form.name_cn,callback:function(e){t.$set(t.form,"name_cn",e)},expression:"form.name_cn"}})],1)],1),a("Col",{attrs:{span:"1"}},[t._v(" ")]),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{"label-width":0,prop:"name_en",rules:{required:!0,message:"请输入学校名称(英文)",trigger:"change"}}},[a("Input",{attrs:{type:"text",placeholder:"英文",maxlength:255},model:{value:t.form.name_en,callback:function(e){t.$set(t.form,"name_en",e)},expression:"form.name_en"}})],1)],1)],1)],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",loading:t.saving},on:{click:t.handleSave}},[t.saving?a("span",[t._v("保存中")]):a("span",[t._v("确定")])]),a("Button",{attrs:{type:"default"},on:{click:function(e){e.preventDefault(),t.showModal=!1}}},[t._v("关闭")])],1)],1)],1)},l=[],c=a("2f62"),d=a("7e1e"),m={components:{Tables:s["a"]},data:function(){var t=this;return{showModal:!1,tableLoading:!0,saving:!1,canAdd:!1,canRemove:!1,modalTitle:"",form:{id:"",name_cn:"",name_en:""},columns:[{title:"学校名称(中)",key:"name_cn",align:"center"},{title:"学校名称(英)",key:"name_en",align:"center"},{title:"操作",key:"handle",width:100,align:"center",button:[function(e,a,o){if(t.canModify)return e("Button",{props:{type:"text",size:"small"},style:{color:"#2b85e4"},on:{click:function(){t.handleModify(a)}}},"编辑")},function(e,a,o){if(t.canRemove)return e("Poptip",{props:{confirm:!0,title:"你确定要删除吗?"},style:{textAlign:"left"},on:{"on-ok":function(){t.handleRemove(a).then(function(t){o.$emit("input",a.tableData.filter(function(t,e){return e!==a.row.initRowIndex}))})}}},[e("Button",{props:{type:"text",size:"small"},style:{color:"#ed4014"}},"删除")])}]}],tableData:[]}},methods:Object(r["a"])({},Object(c["b"])(["userCan"]),{loadSchool:function(t){var e=this;t&&(this.form.city_id=t),this.tableLoading=!0,Object(d["l"])({city_id:this.form.city_id}).then(function(t){e.tableLoading=!1;var a=t.data;"y"===a.status?e.tableData=a.data:e.$Message.error(a.msg)}).catch(function(t){})},handleAdd:function(){this.showModal=!0,this.modalTitle="添加学校",this.$refs.form.resetFields(),this.form.id=""},handleSave:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.saving=!0,""==t.form.id?Object(d["e"])(t.form).then(function(e){t.saving=!1;var a=e.data;"y"===a.status?(t.$Message.success(a.msg),t.showModal=!1,t.$refs.form.resetFields(),t.loadSchool()):t.$Message.error(a.msg)}).catch(function(e){t.saving=!1,t.$Message.error(e.message)}):Object(d["q"])(t.form).then(function(e){t.saving=!1;var a=e.data;"y"===a.status?(t.$Message.success(a.msg),t.showModal=!1,t.$refs.form.resetFields(),t.loadSchool()):t.$Message.error(a.msg)}).catch(function(e){t.saving=!1,t.$Message.error(e)}))})},handleRemove:function(t){var e=this;this.$Message.loading({content:"删除中...",duration:0});var a=t.row.id;return new Promise(function(t,o){Object(d["v"])({id:a}).then(function(a){e.$Message.destroy();var o=a.data;"y"===o.status?(e.$Message.success(o.msg),t()):e.$Message.error(o.msg)}).catch(function(t){e.$Message.destroy()})})},handleModify:function(t){this.showModal=!0,this.modalTitle="编辑学校",this.form=t.row}}),mounted:function(){var t=this;this.userCan("City_Add").then(function(e){t.canAdd=e}),this.userCan("City_Modify").then(function(e){t.canModify=e}),this.userCan("City_Remove").then(function(e){t.canRemove=e})}},u=m,f=a("2877"),h=Object(f["a"])(u,i,l,!1,null,null,null),p=h.exports,y=p,g=a("5289"),v=a("f121"),b={components:{Tables:s["a"],MediaModal:g["a"],SchoolModal:y},data:function(){var t=this;return{baseUrl:v["a"].baseUrl.pro,showCityModal:!1,showMediaModal:!1,showSchoolModal:!1,modalTitle:"",formSearch:{country_id:"",abbr:"",name_cn:"",name_en:"",is_hot:"",page:1,pageSize:20},total:0,formCity:{id:"",country_id:"",abbr:"",name_cn:"",name_en:"",area_cn:"",area_en:"",climate_cn:"",climate_en:"",feature_cn:"",feature_en:"",livable_rank:"",cover:{url:"",name:"",file:""}},countryList:[],saving:!1,tableLoading:!0,canAdd:!1,canModify:!1,canRemove:!1,canMedia:!1,columns:[{title:"ID",width:60,key:"ID"},{title:"缩写",width:60,key:"abbr",align:"center"},{title:"封面",width:66,align:"center",key:"cover",render:function(t,e){return t("img",{style:{width:"50px",height:"auto"},attrs:{src:e.row.cover}})}},{title:"国家",key:"country_name",align:"center"},{title:"中文名称",key:"name_cn",align:"center"},{title:"英文名称",key:"name_en",align:"center"},{title:"面积",key:"area",align:"center"},{title:"气候",key:"climate",align:"center"},{title:"特色",key:"feature",align:"center"},{title:"宜居城市排名",key:"livable_rank",align:"center"},{title:"热门城市",key:"is_hot",align:"center",render:function(e,a){return e("Checkbox",{props:{value:1==a.row.is_hot},on:{"on-change":function(){t.setCityHot(a.row.id)}}})}},{title:"添加时间",width:80,key:"time",align:"center"},{title:"操作",key:"handle",width:180,align:"center",className:"action-column",button:[function(e,a,o){if(t.canMedia)return e("Button",{props:{type:"text",size:"small"},style:{color:"#2d8cf0"},on:{click:function(){t.showSchool(a)}}},"学校")},function(e,a,o){if(t.canMedia)return e("Button",{props:{type:"text",size:"small"},style:{color:"#2d8cf0"},on:{click:function(){t.showMedia(a)}}},"媒体")},function(e,a,o){if(t.canModify)return e("Button",{props:{type:"text",size:"small"},style:{color:"#2b85e4"},on:{click:function(){t.modifyCity(a)}}},"编辑")},function(e,a,o){if(t.canRemove)return e("Poptip",{props:{confirm:!0,title:"你确定要删除吗?"},style:{textAlign:"left"},on:{"on-ok":function(){t.removeCity(a).then(function(t){o.$emit("input",a.tableData.filter(function(t,e){return e!==a.row.initRowIndex}))})}}},[e("Button",{props:{type:"text",size:"small"},style:{color:"#ed4014"}},"删除")])}]}],tableData:[]}},methods:Object(r["a"])({},Object(c["b"])(["userCan"]),{searchNow:function(){this.formSearch.page=1,this.loadCity()},searchReset:function(){this.formSearch.name="",this.$refs.formSearch.resetFields(),this.loadCity()},pageChange:function(t){this.formSearch.page=t,this.loadCity()},pageSizeChange:function(t){this.formSearch.pageSize=t,this.loadCity()},addCity:function(){this.showCityModal=!0,this.modalTitle="添加城市",this.$refs.formCity.resetFields(),this.formCity.id=""},handleSaveCity:function(){var t=this;this.$refs.formCity.validate(function(e){e&&(t.saving=!0,""==t.formCity.id?Object(d["a"])(t.formCity).then(function(e){t.saving=!1;var a=e.data;"y"===a.status?(t.$Message.success(a.msg),t.showCityModal=!1,t.$refs.formCity.resetFields(),t.loadCity()):t.$Message.error(a.msg)}).catch(function(e){t.saving=!1,t.$Message.error(e.message)}):Object(d["m"])(t.formCity).then(function(e){t.saving=!1;var a=e.data;"y"===a.status?(t.$Message.success(a.msg),t.showCityModal=!1,t.$refs.formCity.resetFields(),t.loadCity()):t.$Message.error(a.msg)}).catch(function(e){t.saving=!1,t.$Message.error(e)}))})},modifyCity:function(t){var e=this;this.getCityInfo(t.row.id).then(function(t){e.showCityModal=!0,e.modalTitle="编辑城市信息",e.formCity=t.data})},handleCloseCityModal:function(){this.showCityModal=!1,this.$refs.formCity.resetFields()},setCityHot:function(t){var e=this;Object(d["m"])({act:"hot",id:t}).then(function(t){var a=t.data;"y"===a.status?e.$Message.success(a.msg):e.$Message.error(a.msg)}).catch(function(t){e.$Message.error(t)})},getCityInfo:function(t){var e=this;return this.$Message.loading({content:"获取城市信息...",duration:0}),new Promise(function(a,o){Object(d["g"])({id:t}).then(function(t){e.$Message.destroy();var o=t.data;"y"===o.status?a(o):e.$Message.error(o.msg)}).catch(function(t){e.$Message.destroy()})})},removeCity:function(t){var e=this;this.$Message.loading({content:"删除中...",duration:0});var a=t.row.id;return new Promise(function(t,o){Object(d["r"])({id:a}).then(function(a){e.$Message.destroy();var o=a.data;"y"===o.status?(e.$Message.success(o.msg),t()):e.$Message.error(o.msg)}).catch(function(t){e.$Message.destroy()})})},loadCountry:function(){var t=this;Object(d["h"])({}).then(function(e){var a=e.data;"y"===a.status?t.countryList=a.data.data:t.$Message.error(a.msg)}).catch(function(t){})},loadCity:function(){var t=this;this.tableLoading=!0,Object(d["f"])({search:this.formSearch}).then(function(e){t.tableLoading=!1;var a=e.data;"y"===a.status?(t.formSearch.pageSize=a.data.size,t.total=a.data.total,t.tableData=a.data.data):t.$Message.error(a.msg)}).catch(function(t){})},handleUploadSuccess:function(t,e){"y"===t.status?this.formCity.cover=t.data:this.$Message.error(t.msg)},handleUploadFormatError:function(t){this.$Notice.warning({title:"文件格式错误",desc:"文件 "+t.name+" 格式不正确, 仅支持png, jpg, jpeg, gif格式."})},handleUploadMaxSize:function(t){this.$Notice.warning({title:"文件大小超出限制",desc:"文件  "+t.name+" 太大了, 不能超过2M."})},removeCover:function(){this.formCity.cover={file:"",name:"",url:""}},showSchool:function(t){this.showSchoolModal=!0,this.modalTitle="「"+t.row.name_cn+"」学校",this.$refs.schoolModal.canAdd=this.canAdd,this.$refs.schoolModal.canModify=this.canModify,this.$refs.schoolModal.canRemove=this.canRemove,this.$refs.schoolModal.loadSchool(t.row.id)},showMedia:function(t){this.showMediaModal=!0,this.modalTitle="「"+t.row.name_cn+"」媒体资源",this.$refs.mediaModal.loadMediaList(2,t.row.id)}}),mounted:function(){var t=this;this.loadCountry(),this.loadCity(),this.userCan("Data_CityAdd").then(function(e){t.canAdd=e}),this.userCan("Data_CityModify").then(function(e){t.canModify=e}),this.userCan("Data_CityRemove").then(function(e){t.canRemove=e}),this.userCan("Data_Media").then(function(e){t.canMedia=e})}},_=b,C=(a("e4af"),Object(f["a"])(_,o,n,!1,null,"012c7e71",null));e["default"]=C.exports},e4af:function(t,e,a){"use strict";var o=a("535e"),n=a.n(o);n.a}}]);