(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2eafb5dd"],{9552:function(t,e,a){},e47f:function(t,e,a){"use strict";var n=a("9552"),o=a.n(n);o.a},fcf0:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Card",{attrs:{shadow:""}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("楼盘管理")]),a("a",{directives:[{name:"show",rawName:"v-show",value:t.canAdd,expression:"canAdd"}],attrs:{slot:"extra",role:"button"},on:{click:function(e){return e.preventDefault(),t.addBuilding(e)}},slot:"extra"},[a("Icon",{attrs:{type:"md-add-circle",size:16}}),t._v("添加楼盘\n        ")],1),a("Form",{ref:"formSearch",staticClass:"form-search",attrs:{"label-width":80,model:t.formSearch,inline:""},nativeOn:{submit:function(t){t.preventDefault()},keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchNow(e)}}},[a("FormItem",{attrs:{label:"所在国家",prop:"country_id"}},[a("Select",{on:{"on-change":t.loadCity},model:{value:t.formSearch.country_id,callback:function(e){t.$set(t.formSearch,"country_id",e)},expression:"formSearch.country_id"}},t._l(t.countryList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name_cn))])}),1)],1),a("FormItem",{attrs:{label:"所在城市",prop:"city_id"}},[a("Select",{model:{value:t.formSearch.city_id,callback:function(e){t.$set(t.formSearch,"city_id",e)},expression:"formSearch.city_id"}},t._l(t.cityList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name_cn))])}),1)],1),a("FormItem",{attrs:{label:"经纪人",prop:"broker_id"}},[a("Select",{model:{value:t.formSearch.broker_id,callback:function(e){t.$set(t.formSearch,"broker_id",e)},expression:"formSearch.broker_id"}},t._l(t.brokersList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name_cn))])}),1)],1),a("FormItem",{attrs:{label:"热门楼盘",prop:"is_hot"}},[a("Select",{model:{value:t.formSearch.is_hot,callback:function(e){t.$set(t.formSearch,"is_hot",e)},expression:"formSearch.is_hot"}},[a("Option",{attrs:{value:"1"}},[t._v("是")]),a("Option",{attrs:{value:"0"}},[t._v("否")])],1)],1),a("FormItem",{attrs:{label:"中文名称",prop:"name_cn"}},[a("Input",{attrs:{placeholder:"输入楼盘中文名称"},model:{value:t.formSearch.name_cn,callback:function(e){t.$set(t.formSearch,"name_cn",e)},expression:"formSearch.name_cn"}})],1),a("FormItem",{attrs:{label:"英文名称",prop:"name_en"}},[a("Input",{attrs:{placeholder:"输入楼盘英文名称"},model:{value:t.formSearch.name_en,callback:function(e){t.$set(t.formSearch,"name_en",e)},expression:"formSearch.name_en"}})],1),a("FormItem",{attrs:{"label-width":0}},[a("Button",{attrs:{type:"primary"},on:{click:t.searchNow}},[t._v("搜索")])],1),a("FormItem",{attrs:{"label-width":0}},[a("Button",{attrs:{type:"default"},on:{click:t.searchReset}},[t._v("重置")])],1)],1),a("tables",{ref:"tables",attrs:{loading:t.tableLoading,columns:t.columns},model:{value:t.tableData,callback:function(e){t.tableData=e},expression:"tableData"}}),a("Page",{ref:"pager",staticStyle:{"margin-top":"15px"},attrs:{current:t.formSearch.page,total:t.total,"page-size":t.formSearch.pageSize,"page-size-opts":[20,40,60,100,500,1e3,5e3,1e4],"show-sizer":"","show-elevator":"","show-total":""},on:{"on-change":t.pageChange,"on-page-size-change":t.pageSizeChange}})],1),a("Modal",{attrs:{width:800,title:t.modalTitle,"mask-closable":!1},model:{value:t.showBuildingModal,callback:function(e){t.showBuildingModal=e},expression:"showBuildingModal"}},[a("Form",{ref:"formBuilding",attrs:{"label-width":80,model:t.formBuilding},nativeOn:{submit:function(t){t.preventDefault()}}},[a("Row",[a("Col",{attrs:{span:"6"}},[a("FormItem",{attrs:{label:"所在国家",prop:"country_id",rules:{required:!0,message:"请选择国家",trigger:"change"}}},[a("Select",{on:{"on-change":t.loadCity},model:{value:t.formBuilding.country_id,callback:function(e){t.$set(t.formBuilding,"country_id",e)},expression:"formBuilding.country_id"}},t._l(t.countryList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name_cn))])}),1)],1)],1),a("Col",{attrs:{span:"6"}},[a("FormItem",{attrs:{label:"所在城市",prop:"city_id",rules:{required:!0,message:"请选择城市",trigger:"change"}}},[a("Select",{model:{value:t.formBuilding.city_id,callback:function(e){t.$set(t.formBuilding,"city_id",e)},expression:"formBuilding.city_id"}},t._l(t.cityList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name_cn))])}),1)],1)],1),a("Col",{attrs:{span:"6"}},[a("FormItem",{attrs:{label:"经纪人",prop:"broker_id",rules:{required:!0,message:"请选择经纪人",trigger:"change"}}},[a("Select",{model:{value:t.formBuilding.broker_id,callback:function(e){t.$set(t.formBuilding,"broker_id",e)},expression:"formBuilding.broker_id"}},t._l(t.brokersList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name_cn))])}),1)],1)],1),a("Col",{attrs:{span:"6"}},[a("FormItem",{attrs:{label:"排序",prop:"sort"}},[a("Input",{attrs:{type:"number",placeholder:"不填将会自动排序"},model:{value:t.formBuilding.sort,callback:function(e){t.$set(t.formBuilding,"sort",e)},expression:"formBuilding.sort"}})],1)],1)],1),a("FormItem",{attrs:{label:"楼盘名称"}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{"label-width":0,prop:"name_cn",rules:{required:!0,message:"请输入楼盘名称(中文)",trigger:"change"}}},[a("Input",{attrs:{type:"text",placeholder:"中文楼盘名称",maxlength:255},model:{value:t.formBuilding.name_cn,callback:function(e){t.$set(t.formBuilding,"name_cn",e)},expression:"formBuilding.name_cn"}})],1)],1),a("Col",{attrs:{span:"1"}},[t._v(" ")]),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{"label-width":0,prop:"name_en",rules:{required:!0,message:"请输入楼盘姓名(英文)",trigger:"change"}}},[a("Input",{attrs:{type:"text",placeholder:"英文楼盘名称",maxlength:255},model:{value:t.formBuilding.name_en,callback:function(e){t.$set(t.formBuilding,"name_en",e)},expression:"formBuilding.name_en"}})],1)],1)],1)],1),a("FormItem",{attrs:{label:"楼盘地址"}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{"label-width":0,prop:"address_cn",rules:{required:!0,message:"请输入楼盘地址(中文)",trigger:"change"}}},[a("Input",{attrs:{type:"text",placeholder:"中文楼盘地址",maxlength:255},model:{value:t.formBuilding.address_cn,callback:function(e){t.$set(t.formBuilding,"address_cn",e)},expression:"formBuilding.address_cn"}})],1)],1),a("Col",{attrs:{span:"1"}},[t._v(" ")]),a("Col",{attrs:{span:"12"}},[a("FormItem",{attrs:{"label-width":0,prop:"address_en",rules:{required:!0,message:"请输入楼盘地址(英文)",trigger:"change"}}},[a("Input",{attrs:{type:"text",placeholder:"英文楼盘地址",maxlength:255},model:{value:t.formBuilding.address_en,callback:function(e){t.$set(t.formBuilding,"address_en",e)},expression:"formBuilding.address_en"}})],1)],1)],1)],1),a("Row",[a("Col",{attrs:{span:"12"}},[a("Row",[a("Col",{attrs:{span:"14"}},[a("FormItem",{attrs:{label:"交付时间",prop:"delivery_time_cn"}},[a("Input",{attrs:{type:"text",placeholder:"输入中文交付时间",maxlength:255},model:{value:t.formBuilding.delivery_time_cn,callback:function(e){t.$set(t.formBuilding,"delivery_time_cn",e)},expression:"formBuilding.delivery_time_cn"}})],1)],1),a("Col",{attrs:{span:"1"}},[t._v(" ")]),a("Col",{attrs:{span:"9"}},[a("FormItem",{attrs:{"label-width":0,prop:"delivery_time_en"}},[a("Input",{attrs:{type:"text",placeholder:"输入英文交付时间",maxlength:255},model:{value:t.formBuilding.delivery_time_en,callback:function(e){t.$set(t.formBuilding,"delivery_time_en",e)},expression:"formBuilding.delivery_time_en"}})],1)],1)],1)],1),a("Col",{attrs:{span:"6"}},[a("FormItem",{attrs:{label:"产权年限",prop:"property_years"}},[a("Input",{attrs:{type:"number",placeholder:"输入产权年限",maxlength:255},model:{value:t.formBuilding.property_years,callback:function(e){t.$set(t.formBuilding,"property_years",e)},expression:"formBuilding.property_years"}})],1)],1),a("Col",{attrs:{span:"6"}},[a("FormItem",{attrs:{label:"项目状态",prop:"project_status"}},[a("Select",{model:{value:t.formBuilding.project_status,callback:function(e){t.$set(t.formBuilding,"project_status",e)},expression:"formBuilding.project_status"}},t._l(t.projectStatusList,function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.title))])}),1)],1)],1)],1),a("FormItem",{attrs:{label:"贷款须知(中)",prop:"loans_cn"}},[a("editor",{ref:"loansCnEditor",attrs:{value:t.formBuilding.loans_cn},on:{"on-change":t.handleLoansCnChange}})],1),a("FormItem",{attrs:{label:"贷款须知(英)",prop:"loans_en"}},[a("editor",{ref:"loansEnEditor",attrs:{value:t.formBuilding.loans_en},on:{"on-change":t.handleLoansEnChange}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",loading:t.saving},on:{click:t.handleSaveBuilding}},[t.saving?a("span",[t._v("保存中")]):a("span",[t._v("确定")])]),a("Button",{attrs:{type:"default"},on:{click:t.handleCloseBuildingModal}},[t._v("关闭")])],1)],1),a("Modal",{attrs:{width:600,title:t.modalTitle,"mask-closable":!1},model:{value:t.showMediaModal,callback:function(e){t.showMediaModal=e},expression:"showMediaModal"}},[a("media-modal",{ref:"mediaModal"}),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:function(e){t.showMediaModal=!1}}},[t._v("关闭")])],1)],1),a("Modal",{attrs:{width:600,title:t.modalTitle,"mask-closable":!1},model:{value:t.showApartmentModal,callback:function(e){t.showApartmentModal=e},expression:"showApartmentModal"}},[a("apartment-modal",{ref:"apartmentModal"}),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:function(e){t.showApartmentModal=!1}}},[t._v("关闭")])],1)],1),a("Modal",{attrs:{width:700,title:t.modalTitle,"mask-closable":!1},model:{value:t.showTagsModal,callback:function(e){t.showTagsModal=e},expression:"showTagsModal"}},[a("tags-modal",{ref:"tagsModal"}),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:function(e){t.showTagsModal=!1}}},[t._v("关闭")])],1)],1)],1)},o=[],i=(a("7f7f"),a("cebc")),r=a("fa69"),s=a("2f62"),l=a("f121"),d=a("a0f0"),c=a("5289"),u=a("d25a"),m=a("8d20"),f=a("7e1e"),h=a("5841"),g=a("8966"),p={components:{Tables:r["a"],Editor:d["a"],MediaModal:c["a"],ApartmentModal:u["a"],TagsModal:m["a"]},data:function(){var t=this;return{baseUrl:l["a"].baseUrl.pro,showBuildingModal:!1,showMediaModal:!1,showApartmentModal:!1,showTagsModal:!1,modalTitle:"",formSearch:{country_id:"",city_id:"",broker_id:"",is_hot:"",name_cn:"",name_en:"",page:1,pageSize:20},total:0,formBuilding:{id:"",country_id:"",city_id:"",broker_id:"",name_cn:"",name_en:"",address_cn:"",address_en:"",delivery_time_cn:"",delivery_time_en:"",property_years:"",project_status:"0",loans_cn:"",loans_en:"",sort:""},saving:!1,tableLoading:!0,canAdd:!1,canModify:!1,canRemove:!1,canMedia:!1,columns:[{title:"ID",width:60,key:"ID"},{title:"中文名称",key:"name_cn",align:"center"},{title:"英文名称",key:"name_en",align:"center"},{title:"所在国家",key:"country",align:"center"},{title:"所在城市",key:"city",align:"center"},{title:"经纪人",key:"broker",align:"center"},{title:"交付时间",key:"delivery_time",align:"center"},{title:"产权年限",key:"property_years",align:"center"},{title:"项目状态",key:"project_status",align:"center"},{title:"精品楼盘",key:"is_hot",align:"center",render:function(e,a){return e("Checkbox",{props:{value:1==a.row.is_hot},on:{"on-change":function(){t.setBuildingHot(a.row.id)}}})}},{title:"排序",key:"sort",align:"center"},{title:"添加时间",width:80,key:"time",align:"center"},{title:"操作",key:"handle",width:390,align:"center",className:"action-column",button:[function(e,a,n){return e("Button",{props:{type:"text",size:"small"},style:{color:"#2b85e4"},on:{click:function(){t.showPDF(a,"cn")}}},"PDF(中)")},function(e,a,n){return e("Button",{props:{type:"text",size:"small"},style:{color:"#2b85e4"},on:{click:function(){t.showPDF(a,"en")}}},"PDF(英)")},function(e,a,n){return e("Button",{props:{type:"text",size:"small"},style:{color:"#2b85e4"},on:{click:function(){t.showApartment(a)}}},"户型")},function(e,a,n){return e("Button",{props:{type:"text",size:"small"},style:{color:"#2b85e4"},on:{click:function(){t.showTags(a)}}},"标签")},function(e,a,n){return e("Button",{props:{type:"text",size:"small"},style:{color:"#2b85e4"},on:{click:function(){t.showProcess(a)}}},"购房流程")},function(e,a,n){if(t.canMedia)return e("Button",{props:{type:"text",size:"small"},style:{color:"#2b85e4"},on:{click:function(){t.showMedia(a)}}},"媒体")},function(e,a,n){if(t.canModify)return e("Button",{props:{type:"text",size:"small"},style:{color:"#2b85e4"},on:{click:function(){t.modifyBuilding(a)}}},"编辑")},function(e,a,n){if(t.canRemove)return e("Poptip",{props:{confirm:!0,title:"你确定要删除吗?"},style:{textAlign:"left"},on:{"on-ok":function(){t.removeBuilding(a).then(function(t){n.$emit("input",a.tableData.filter(function(t,e){return e!==a.row.initRowIndex}))})}}},[e("Button",{props:{type:"text",size:"small"},style:{color:"#ed4014"}},"删除")])}]}],tableData:[],countryList:[],cityList:[],brokersList:[],projectStatusList:[]}},methods:Object(i["a"])({},Object(s["b"])(["userCan","getConstants"]),{searchNow:function(){this.formSearch.page=1,this.loadBuildings()},searchReset:function(){this.formSearch.name="",this.$refs.formSearch.resetFields(),this.loadBuildings()},pageChange:function(t){this.formSearch.page=t,this.loadBuildings()},pageSizeChange:function(t){this.formSearch.pageSize=t,this.loadBuildings()},addBuilding:function(){this.showBuildingModal=!0,this.modalTitle="添加楼盘",this.$refs.formBuilding.resetFields(),this.formBuilding.id="",this.$refs.loansCnEditor.setHtml(""),this.$refs.loansEnEditor.setHtml("")},handleSaveBuilding:function(){var t=this;this.$refs.formBuilding.validate(function(e){e&&(t.saving=!0,""==t.formBuilding.id?Object(g["b"])(t.formBuilding).then(function(e){t.saving=!1;var a=e.data;"y"===a.status?(t.$Message.success(a.msg),t.showBuildingModal=!1,t.$refs.formBuilding.resetFields(),t.loadBuildings()):t.$Message.error(a.msg)}).catch(function(e){t.saving=!1,t.$Message.error(e.message)}):Object(g["g"])(t.formBuilding).then(function(e){t.saving=!1;var a=e.data;"y"===a.status?(t.$Message.success(a.msg),t.showBuildingModal=!1,t.$refs.formBuilding.resetFields(),t.loadBuildings()):t.$Message.error(a.msg)}).catch(function(e){t.saving=!1,t.$Message.error(e)}))})},modifyBuilding:function(t){var e=this;this.getBuildingInfo(t.row.id).then(function(t){e.showBuildingModal=!0,e.modalTitle="编辑楼盘信息",e.formBuilding=t.data,e.$refs.loansCnEditor.setHtml(e.formBuilding.loans_cn),e.$refs.loansEnEditor.setHtml(e.formBuilding.loans_en),e.loadCity(t.data.country_id)})},handleCloseBuildingModal:function(){this.showBuildingModal=!1,this.$refs.formBuilding.resetFields()},handleLoansCnChange:function(t,e){this.formBuilding.loans_cn=t},handleLoansEnChange:function(t,e){this.formBuilding.loans_en=t},setBuildingHot:function(t){var e=this;Object(g["g"])({act:"hot",id:t}).then(function(t){var a=t.data;"y"===a.status?e.$Message.success(a.msg):e.$Message.error(a.msg)}).catch(function(t){e.$Message.error(t)})},getBuildingInfo:function(t){var e=this;return this.$Message.loading({content:"获取楼盘信息...",duration:0}),new Promise(function(a,n){Object(g["d"])({id:t}).then(function(t){e.$Message.destroy();var n=t.data;"y"===n.status?a(n):e.$Message.error(n.msg)}).catch(function(t){e.$Message.destroy()})})},removeBuilding:function(t){var e=this;this.$Message.loading({content:"删除中...",duration:0});var a=t.row.id;return new Promise(function(t,n){Object(g["i"])({id:a}).then(function(a){e.$Message.destroy();var n=a.data;"y"===n.status?(e.$Message.success(n.msg),t()):e.$Message.error(n.msg)}).catch(function(t){e.$Message.destroy()})})},loadBuildings:function(){var t=this;this.tableLoading=!0,Object(g["e"])({search:this.formSearch}).then(function(e){t.tableLoading=!1;var a=e.data;"y"===a.status?(t.formSearch.pageSize=a.data.size,t.total=a.data.total,t.tableData=a.data.data):t.$Message.error(a.msg)}).catch(function(t){})},handleUploadSuccess:function(t,e){"y"===t.status?this.formBuilding.avatar=t.data:this.$Message.error(t.msg)},handleUploadFormatError:function(t){this.$Notice.warning({title:"文件格式错误",desc:"文件 "+t.name+" 格式不正确, 仅支持pdf格式."})},handleUploadMaxSize:function(t){this.$Notice.warning({title:"文件大小超出限制",desc:"文件  "+t.name+" 太大了, 不能超过50M."})},removeAvatar:function(){this.formBuilding.avatar={file:"",name:"",url:""}},loadCountry:function(){var t=this;Object(f["h"])({}).then(function(e){var a=e.data;"y"===a.status&&(t.countryList=a.data.data)}).catch(function(t){})},loadCity:function(t){var e=this;Object(f["f"])({search:{country_id:t}}).then(function(t){var a=t.data;"y"===a.status&&(e.cityList=a.data.data)}).catch(function(t){})},loadBrokers:function(){var t=this;Object(h["c"])({}).then(function(e){var a=e.data;"y"===a.status&&(t.brokersList=a.data.data)}).catch(function(t){})},showApartment:function(t){this.showApartmentModal=!0,this.modalTitle="「"+t.row.name_cn+"」户型",this.$refs.apartmentModal.canAdd=this.canAdd,this.$refs.apartmentModal.canModify=this.canModify,this.$refs.apartmentModal.canRemove=this.canRemove,this.$refs.apartmentModal.loadApartments(t.row.id)},showTags:function(t){this.showTagsModal=!0,this.modalTitle="「"+t.row.name_cn+"」标签",this.$refs.tagsModal.canAdd=this.canAdd,this.$refs.tagsModal.canModify=this.canModify,this.$refs.tagsModal.canRemove=this.canRemove,this.$refs.tagsModal.loadTags(t.row.id,1)},showMedia:function(t){this.showMediaModal=!0,this.modalTitle="「"+t.row.name_cn+"」媒体资源",this.$refs.mediaModal.loadMediaList(3,t.row.id)},showProcess:function(t){this.showMediaModal=!0,this.modalTitle="「"+t.row.name_cn+"」购房流程",this.$refs.mediaModal.loadMediaList(4,t.row.id)},showPDF:function(t,e){this.showMediaModal=!0,this.modalTitle="「"+t.row.name_cn+"」PDF("+("中"==e?"CN":"英")+")",this.$refs.mediaModal.loadMediaList("cn"==e?5:6,t.row.id)}}),mounted:function(){var t=this;this.loadBuildings(),this.loadCountry(),this.loadBrokers(),this.userCan("Buildings_Add").then(function(e){t.canAdd=e}),this.userCan("Buildings_Modify").then(function(e){t.canModify=e}),this.userCan("Buildings_Remove").then(function(e){t.canRemove=e}),this.userCan("Data_Media").then(function(e){t.canMedia=e}),this.getConstants().then(function(e){t.projectStatusList=e.PROJECT_STATUS})}},_=p,y=(a("e47f"),a("2877")),v=Object(y["a"])(_,n,o,!1,null,"7962fcf9",null);e["default"]=v.exports}}]);